<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Prompt Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .input-section {
            padding: 40px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .output-section {
            padding: 40px;
            background: white;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .checkbox-item.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .checkbox-item input {
            display: none;
        }

        .generate-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .output-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .output-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .output-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .api-setup {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .api-setup h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .product-manager {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .product-manager h4 {
            color: #1565c0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 8px 16px;
            border: 2px solid #90caf9;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .tab-btn.active {
            background: #1976d2;
            color: white;
            border-color: #1976d2;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .saved-products {
            display: grid;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .product-item:hover {
            border-color: #1976d2;
            background: #f3f8ff;
        }

        .product-item.selected {
            border-color: #1976d2;
            background: #e3f2fd;
        }

        .product-info h5 {
            margin: 0 0 4px 0;
            color: #333;
            font-size: 0.95rem;
        }

        .product-info p {
            margin: 0;
            color: #666;
            font-size: 0.8rem;
        }

        .product-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #ff9800;
            color: white;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-small:hover {
            transform: scale(1.05);
        }

        .create-product-form {
            display: grid;
            gap: 15px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Instagram Prompt Generator</h1>
            <p>Create engaging prompts and captions for your Instagram posts</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="api-setup">
                    <h4>üîë API Configuration</h4>
                    <div class="form-group">
                        <select id="apiProvider" class="form-control">
                            <option value="gemini">Google Gemini</option>
                            <option value="groq">Groq</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="useHardcodedKey" style="margin-right: 8px;">
                            Use hardcoded API key (for testing)
                        </label>
                    </div>
                    <div class="form-group" id="manualKeyInput">
                        <input type="password" id="apiKey" class="form-control" placeholder="Enter your API key">
                    </div>
                </div>

                <div class="product-manager">
                    <h4>üì¶ Product Management</h4>
                    
                    <div class="product-tabs">
                        <button class="tab-btn active" onclick="switchTab('saved')">üìã Saved Products</button>
                        <button class="tab-btn" onclick="switchTab('create')">‚ûï Create New</button>
                    </div>

                    <div id="savedTab" class="tab-content active">
                        <div class="saved-products" id="savedProductsList">
                            <div style="text-align: center; padding: 20px; color: #666;">
                                No saved products yet. Create one using the "Create New" tab!
                            </div>
                        </div>
                    </div>

                    <div id="createTab" class="tab-content">
                        <form class="create-product-form" id="productForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Product/Brand Name</label>
                                    <input type="text" id="productName" class="form-control" placeholder="e.g., FitTracker Pro">
                                </div>
                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="productCategory" class="form-control">
                                        <option value="Fashion & Apparel">Fashion & Apparel</option>
                                        <option value="Beauty & Skincare">Beauty & Skincare</option>
                                        <option value="Food & Beverages">Food & Beverages</option>
                                        <option value="Technology & Gadgets">Technology & Gadgets</option>
                                        <option value="Fitness & Health">Fitness & Health</option>
                                        <option value="Home & Decor">Home & Decor</option>
                                        <option value="Travel & Lifestyle">Travel & Lifestyle</option>
                                        <option value="Education & Courses">Education & Courses</option>
                                        <option value="Custom">Custom Category</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Product Description</label>
                                <textarea id="productDescription" class="form-control" rows="3" placeholder="Brief description of what your product does, its key features, and benefits..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Brand Motto/Mission</label>
                                <input type="text" id="productMotto" class="form-control" placeholder="e.g., Empowering fitness journeys through smart technology">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Key Features (comma separated)</label>
                                    <input type="text" id="productFeatures" class="form-control" placeholder="e.g., AI tracking, 24/7 monitoring, mobile app">
                                </div>
                                <div class="form-group">
                                    <label>Target Market</label>
                                    <input type="text" id="productMarket" class="form-control" placeholder="e.g., Fitness enthusiasts, Health-conscious individuals">
                                </div>
                            </div>
                            
                            <button type="submit" class="generate-btn">üíæ Save Product Profile</button>
                        </form>
                    </div>
                </div>

                <div class="form-group">
                    <label for="selectedProduct">Selected Product</label>
                    <div id="selectedProductDisplay" style="padding: 12px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6; text-align: center; color: #6c757d;">
                        No product selected. Please create or select a product above.
                    </div>
                </div>

                <form id="promptForm">
                    <div class="form-group">
                        <label>Post Type</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="radio" name="postType" value="image" id="image">
                                <label for="image">üì∏ Image</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="postType" value="carousel" id="carousel">
                                <label for="carousel">üé† Carousel</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="postType" value="video" id="video">
                                <label for="video">üé• Video</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="postType" value="reel" id="reel">
                                <label for="reel">üé¨ Reel</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="postType" value="story" id="story">
                                <label for="story">üì± Story</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="postType" value="meme" id="meme">
                                <label for="meme">üòÇ Meme</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="topic">Topic/Theme</label>
                        <input type="text" id="topic" class="form-control" placeholder="e.g., Summer sale, Product launch, Behind the scenes">
                    </div>

                    <div class="form-group">
                        <label for="tone">Brand Voice/Tone</label>
                        <select id="tone" class="form-control">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual & Friendly</option>
                            <option value="humorous">Humorous</option>
                            <option value="inspiring">Inspiring</option>
                            <option value="trendy">Trendy & Hip</option>
                            <option value="educational">Educational</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="targetAudience">Target Audience</label>
                        <input type="text" id="targetAudience" class="form-control" placeholder="e.g., Young professionals, Fitness enthusiasts, Tech lovers">
                    </div>

                    <button type="submit" class="generate-btn">‚ú® Generate Prompt & Caption</button>
                </form>
            </div>

            <div class="output-section">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Generating creative content...</p>
                </div>

                <div id="results" style="display: none;">
                    <div class="output-card">
                        <h3>üé® AI Prompt for Visual Creation</h3>
                        <div class="output-content" id="promptOutput"></div>
                        <button class="copy-btn" onclick="copyToClipboard('promptOutput')">üìã Copy Prompt</button>
                    </div>

                    <div class="output-card">
                        <h3>üìù Instagram Caption</h3>
                        <div class="output-content" id="captionOutput"></div>
                        <button class="copy-btn" onclick="copyToClipboard('captionOutput')">üìã Copy Caption</button>
                    </div>

                    <div class="output-card">
                        <h3>üè∑Ô∏è Recommended Hashtags</h3>
                        <div class="output-content" id="hashtagOutput"></div>
                        <button class="copy-btn" onclick="copyToClipboard('hashtagOutput')">üìã Copy Hashtags</button>
                    </div>
                </div>

                <div id="placeholder" style="text-align: center; color: #6c757d; padding: 60px 20px;">
                    <h3>üëã Ready to Create Amazing Content?</h3>
                    <p>Fill in the form on the left and click generate to get started!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Hardcoded API keys for testing (replace with your actual keys)
        const HARDCODED_KEYS = {
            gemini: 'AIzaSyDpKrF3vetN4EV4kGDgoCK8sHkXkINti1A', // Replace with your Gemini API key
            groq: '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'      // Replace with your Groq API key
        };

        // In-memory storage for the session
        let sessionData = {
            apiKey: '',
            apiProvider: 'gemini',
            useHardcoded: false
        };

        // Product management system
        let savedProducts = [];
        let selectedProduct = null;

        // Load saved products from memory
        function loadSavedProducts() {
            if (savedProducts.length === 0) {
                savedProducts = [
                    {
                        id: 'demo1',
                        name: 'FitTracker Pro',
                        category: 'Fitness & Health',
                        description: 'AI-powered fitness tracking app that monitors workouts, nutrition, and wellness goals with personalized insights.',
                        motto: 'Empowering your fitness journey through smart technology',
                        features: 'AI tracking, 24/7 monitoring, nutrition analysis, social challenges',
                        market: 'Fitness enthusiasts, health-conscious individuals, personal trainers'
                    }
                ];
            }
            renderSavedProducts();
        }

        function renderSavedProducts() {
            const container = document.getElementById('savedProductsList');
            
            if (savedProducts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666;">
                        No saved products yet. Create one using the "Create New" tab!
                    </div>
                `;
                return;
            }

            container.innerHTML = savedProducts.map(product => `
                <div class="product-item ${selectedProduct?.id === product.id ? 'selected' : ''}" onclick="selectProduct('${product.id}')">
                    <div class="product-info">
                        <h5>${product.name}</h5>
                        <p>${product.category} ‚Ä¢ ${product.description.substring(0, 60)}...</p>
                    </div>
                    <div class="product-actions">
                        <button class="btn-small btn-edit" onclick="editProduct('${product.id}'); event.stopPropagation();">‚úèÔ∏è</button>
                        <button class="btn-small btn-delete" onclick="deleteProduct('${product.id}'); event.stopPropagation();">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function selectProduct(productId) {
            selectedProduct = savedProducts.find(p => p.id === productId);
            updateSelectedProductDisplay();
            renderSavedProducts();
        }

        function updateSelectedProductDisplay() {
            const display = document.getElementById('selectedProductDisplay');
            
            if (!selectedProduct) {
                display.innerHTML = 'No product selected. Please create or select a product above.';
                display.style.color = '#6c757d';
                display.style.background = '#f8f9fa';
                display.style.border = '2px dashed #dee2e6';
                return;
            }

            display.innerHTML = `
                <div style="text-align: left;">
                    <strong style="color: #1976d2;">${selectedProduct.name}</strong>
                    <span style="color: #666; font-size: 0.9rem;"> (${selectedProduct.category})</span>
                    <br>
                    <span style="color: #555; font-size: 0.9rem;">${selectedProduct.description}</span>
                </div>
            `;
            display.style.color = '#333';
            display.style.background = '#e3f2fd';
            display.style.border = '2px solid #1976d2';
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                savedProducts = savedProducts.filter(p => p.id !== productId);
                if (selectedProduct?.id === productId) {
                    selectedProduct = null;
                    updateSelectedProductDisplay();
                }
                renderSavedProducts();
            }
        }

        function editProduct(productId) {
            const product = savedProducts.find(p => p.id === productId);
            if (!product) return;

            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productMotto').value = product.motto;
            document.getElementById('productFeatures').value = product.features;
            document.getElementById('productMarket').value = product.market;

            switchTab('create');
            document.getElementById('productForm').dataset.editingId = productId;
        }

        function getFormData() {
            if (!selectedProduct) {
                alert('Please select a product first!');
                return null;
            }
            
            const postType = document.querySelector('input[name="postType"]:checked')?.value;
            
            return {
                product: selectedProduct,
                postType,
                topic: document.getElementById('topic').value,
                tone: document.getElementById('tone').value,
                targetAudience: document.getElementById('targetAudience').value
            };
        }

        function validateForm(data) {
            if (!data) return false;
            if (!data.product) {
                alert('Please select a product first!');
                return false;
            }
            if (!data.postType) {
                alert('Please select a post type!');
                return false;
            }
            if (!data.topic) {
                alert('Please enter a topic or theme!');
                return false;
            }
            return true;
        }

        async function generateContent(formData, apiKey, provider) {
            const prompt = createPrompt(formData);
            
            console.log('Using provider:', provider);
            console.log('API Key length:', apiKey.length);
            console.log('Generated prompt:', prompt);
            
            try {
                if (provider === 'gemini') {
                    return await callGeminiAPI(prompt, apiKey);
                } else {
                    return await callGroqAPI(prompt, apiKey);
                }
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        function createPrompt(data) {
            const product = data.product;
            
            return `You are an expert Instagram content creator. Create highly specific, engaging content for "${product.name}" in the ${product.category} category.

PRODUCT CONTEXT:
Product Name: ${product.name}
Category: ${product.category}
Description: ${product.description}
Brand Mission: ${product.motto}
Key Features: ${product.features}
Target Market: ${product.market}

CONTENT REQUEST:
Post Type: ${data.postType}
Campaign Theme: ${data.topic}
Brand Voice: ${data.tone}
Target Audience: ${data.targetAudience || product.market}

Please create content that reflects the brand's personality and leverages the specific product details above.

IMPORTANT: Respond ONLY with a valid JSON object in this exact format:
{
  "visualPrompt": "Detailed visual description here",
  "caption": "Engaging Instagram caption here", 
  "hashtags": "Space-separated hashtags here"
}

For the visualPrompt: Create a detailed description for AI image generation that includes:
- Specific visual elements related to the product features
- Brand-appropriate colors, mood, and style
- Composition suggestions that highlight the product's unique value
- Lighting and setting that matches the brand mission
- Visual elements that appeal to the target market

Make everything highly specific to ${product.name} and avoid generic descriptions.`;
        }

        async function callGeminiAPI(prompt, apiKey) {
            console.log('Calling Gemini API...');
            
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                })
            });

            console.log('Gemini Response Status:', response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Gemini API Error:', errorText);
                throw new Error(`Gemini API request failed: ${response.status} - ${errorText}`);
            }

            const data = await response.json();
            console.log('Gemini Response:', data);
            
            if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                throw new Error('Invalid response format from Gemini API');
            }
            
            const content = data.candidates[0].content.parts[0].text;
            
            try {
                const parsed = JSON.parse(content);
                console.log('Parsed JSON:', parsed);
                return parsed;
            } catch {
                console.log('Falling back to text parsing...');
                return parseTextResponse(content);
            }
        }

        async function callGroqAPI(prompt, apiKey) {
            console.log('Calling Groq API...');
            
            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'meta-llama/llama-4-scout-17b-16e-instruct',
                    messages: [{
                        role: 'user',
                        content: prompt
                    }],
                    temperature: 0.7
                })
            });

            console.log('Groq Response Status:', response.status);

            if (!response.ok) {
                const errorText = await response.text();
                console.error('Groq API Error:', errorText);
                throw new Error(`Groq API request failed: ${response.status} - ${errorText}`);
            }

            const data = await response.json();
            console.log('Groq Response:', data);
            
            if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                throw new Error('Invalid response format from Groq API');
            }
            
            const content = data.choices[0].message.content;
            
            try {
                const parsed = JSON.parse(content);
                console.log('Parsed JSON:', parsed);
                return parsed;
            } catch {
                console.log('Falling back to text parsing...');
                return parseTextResponse(content);
            }
        }

        function parseTextResponse(text) {
            const product = selectedProduct;
            
            // Try to extract content even if JSON parsing fails
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            let visualPrompt = '';
            let caption = '';
            let hashtags = '';
            
            // Look for content in different sections
            let currentSection = '';
            let contentStarted = false;
            
            for (let line of lines) {
                const lowerLine = line.toLowerCase();
                
                // Skip JSON markers
                if (line.includes('{') || line.includes('}') || line.includes('"visualPrompt"') || line.includes('"caption"') || line.includes('"hashtags"')) {
                    continue;
                }
                
                // Identify sections
                if (lowerLine.includes('visual') && lowerLine.includes('prompt')) {
                    currentSection = 'visual';
                    contentStarted = true;
                    continue;
                } else if (lowerLine.includes('caption')) {
                    currentSection = 'caption';
                    continue;
                } else if (lowerLine.includes('hashtag')) {
                    currentSection = 'hashtags';
                    continue;
                }
                
                // Extract content
                if (contentStarted && line && !line.includes(':')) {
                    // Remove quotes and clean up
                    line = line.replace(/^["']|["']$/g, '').replace(/,$/, '');
                    
                    if (currentSection === 'visual') {
                        visualPrompt += line + ' ';
                    } else if (currentSection === 'caption') {
                        caption += line + ' ';
                    } else if (currentSection === 'hashtags') {
                        hashtags += line + ' ';
                    }
                }
            }
            
            // If extraction failed, create detailed fallback based on product info
            if (!visualPrompt.trim()) {
                visualPrompt = createDetailedVisualPrompt(product);
            }
            
            if (!caption.trim()) {
                caption = createDetailedCaption(product);
            }
            
            if (!hashtags.trim()) {
                hashtags = createDetailedHashtags(product);
            }
            
            return {
                visualPrompt: visualPrompt.trim(),
                caption: caption.trim(),
                hashtags: hashtags.trim()
            };
        }

        function createDetailedVisualPrompt(product) {
            const postType = document.querySelector('input[name="postType"]:checked')?.value || 'image';
            const topic = document.getElementById('topic').value;
            const tone = document.getElementById('tone').value;
            
            let visualElements = [];
            
            // Base elements based on category
            const categoryStyles = {
                'Fitness & Health': 'energetic, dynamic lighting, athletic wear, gym or outdoor setting, vibrant colors',
                'Technology & Gadgets': 'sleek modern design, clean minimalist background, cool blue/white lighting, tech aesthetic',
                'Beauty & Skincare': 'soft natural lighting, elegant background, pastel colors, luxurious feel',
                'Fashion & Apparel': 'stylish composition, trendy background, fashion photography lighting',
                'Food & Beverages': 'appetizing presentation, warm lighting, natural textures, inviting atmosphere',
                'Home & Decor': 'cozy interior setting, warm ambient lighting, lifestyle photography',
                'Travel & Lifestyle': 'adventure setting, natural lighting, inspiring landscape or urban backdrop',
                'Education & Courses': 'professional setting, clear lighting, modern workspace or learning environment'
            };
            
            const baseStyle = categoryStyles[product.category] || 'professional, clean, well-lit setting';
            
            visualElements.push(`${product.name} prominently featured in ${baseStyle}`);
            
            // Add specific elements based on features
            if (product.features.toLowerCase().includes('ai') || product.features.toLowerCase().includes('smart')) {
                visualElements.push('futuristic elements, digital interface overlays, tech-forward composition');
            }
            
            if (product.features.toLowerCase().includes('mobile') || product.features.toLowerCase().includes('app')) {
                visualElements.push('smartphone or device visible, modern tech lifestyle');
            }
            
            // Tone-based visual style
            const toneStyles = {
                'professional': 'corporate aesthetic, sharp focus, business environment',
                'casual': 'relaxed atmosphere, natural poses, everyday setting',
                'humorous': 'playful elements, bright colors, fun composition',
                'inspiring': 'uplifting mood, golden hour lighting, aspirational setting',
                'trendy': 'Instagram-worthy composition, trending visual elements, modern style',
                'educational': 'clear informative layout, organized presentation, learning context'
            };
            
            if (toneStyles[tone]) {
                visualElements.push(toneStyles[tone]);
            }
            
            // Topic integration
            if (topic) {
                visualElements.push(`visual elements relating to ${topic}`);
            }
            
            return `Professional ${postType} showing ${visualElements.join(', ')}, high-resolution, ${product.motto.toLowerCase()} embodied in the visual composition`;
        }

        function createDetailedCaption(product) {
            const topic = document.getElementById('topic').value;
            const tone = document.getElementById('tone').value;
            const audience = document.getElementById('targetAudience').value;
            
            let caption = '';
            
            // Opening hook based on tone
            const hooks = {
                'professional': `Introducing ${product.name} - `,
                'casual': `Hey everyone! üëã Meet ${product.name} - `,
                'humorous': `Plot twist: ${product.name} is here and it's `,
                'inspiring': `‚ú® Transform your journey with ${product.name} - `,
                'trendy': `üî• Everyone's talking about ${product.name} and `,
                'educational': `üìö Let's talk about ${product.name}: `
            };
            
            caption += hooks[tone] || `Meet ${product.name} - `;
            
            // Add description and value prop
            caption += `${product.description} `;
            
            // Add topic context if provided
            if (topic) {
                caption += `Perfect for ${topic.toLowerCase()}! `;
            }
            
            // Add mission/motto
            caption += `\n\nüí° Our mission: ${product.motto}`;
            
            // Add key features
            caption += `\n\nüöÄ Key features:\n${product.features.split(',').map(f => `‚Ä¢ ${f.trim()}`).join('\n')}`;
            
            // Call to action based on audience
            if (audience) {
                caption += `\n\nüì¢ Calling all ${audience.toLowerCase()}! Ready to experience the difference?`;
            }
            
            caption += `\n\n#${product.name.replace(/\s+/g, '')}`;
            
            return caption;
        }

        function createDetailedHashtags(product) {
            const category = product.category.toLowerCase();
            const features = product.features.toLowerCase();
            const productWords = product.name.toLowerCase().split(' ');
            
            let hashtags = new Set();
            
            // Brand hashtags
            hashtags.add(`#${product.name.replace(/\s+/g, '')}`);
            hashtags.add(`#${productWords[0]}`);
            
            // Category hashtags
            const categoryTags = {
                'fitness & health': ['#fitness', '#health', '#wellness', '#workout', '#fitlife', '#healthylifestyle'],
                'technology & gadgets': ['#tech', '#technology', '#gadgets', '#innovation', '#digital', '#smart'],
                'beauty & skincare': ['#beauty', '#skincare', '#cosmetics', '#selfcare', '#beautyproducts', '#glowup'],
                'fashion & apparel': ['#fashion', '#style', '#outfit', '#clothing', '#apparel', '#fashionista'],
                'food & beverages': ['#food', '#foodie', '#delicious', '#nutrition', '#beverages', '#tasty'],
                'home & decor': ['#homedecor', '#interiordesign', '#home', '#decor', '#lifestyle', '#homedesign'],
                'travel & lifestyle': ['#travel', '#lifestyle', '#adventure', '#explore', '#wanderlust', '#life'],
                'education & courses': ['#education', '#learning', '#courses', '#skills', '#knowledge', '#growth']
            };
            
            if (categoryTags[category]) {
                categoryTags[category].forEach(tag => hashtags.add(tag));
            }
            
            // Feature-based hashtags
            if (features.includes('ai')) hashtags.add('#AI');
            if (features.includes('mobile') || features.includes('app')) hashtags.add('#mobileapp');
            if (features.includes('track')) hashtags.add('#tracking');
            if (features.includes('smart')) hashtags.add('#smarttech');
            if (features.includes('monitor')) hashtags.add('#monitoring');
            
            // General engagement hashtags
            ['#innovation', '#quality', '#lifestyle', '#newproduct', '#amazing', '#musthave'].forEach(tag => hashtags.add(tag));
            
            return Array.from(hashtags).slice(0, 20).join(' ');
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('placeholder').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function displayResults(data) {
            hideLoading();
            
            document.getElementById('promptOutput').textContent = data.visualPrompt;
            document.getElementById('captionOutput').textContent = data.caption;
            document.getElementById('hashtagOutput').textContent = data.hashtags;
            
            document.getElementById('results').style.display = 'block';
            document.getElementById('placeholder').style.display = 'none';
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        // Initialize the app
        window.addEventListener('load', function() {
            loadSavedProducts();
            
            // Handle hardcoded key checkbox
            const hardcodedCheckbox = document.getElementById('useHardcodedKey');
            if (hardcodedCheckbox) {
                hardcodedCheckbox.addEventListener('change', function() {
                    sessionData.useHardcoded = this.checked;
                    const manualInput = document.getElementById('manualKeyInput');
                    
                    if (this.checked) {
                        manualInput.style.display = 'none';
                        sessionData.apiKey = HARDCODED_KEYS[sessionData.apiProvider];
                    } else {
                        manualInput.style.display = 'block';
                        sessionData.apiKey = document.getElementById('apiKey').value;
                    }
                });
            }

            // Store API key in session memory
            const apiKeyInput = document.getElementById('apiKey');
            if (apiKeyInput) {
                apiKeyInput.addEventListener('input', function() {
                    if (!sessionData.useHardcoded) {
                        sessionData.apiKey = this.value;
                    }
                });
            }

            const apiProviderSelect = document.getElementById('apiProvider');
            if (apiProviderSelect) {
                apiProviderSelect.addEventListener('change', function() {
                    sessionData.apiProvider = this.value;
                    if (sessionData.useHardcoded) {
                        sessionData.apiKey = HARDCODED_KEYS[this.value];
                    }
                });
            }

            // Handle post type selection
            document.querySelectorAll('input[name="postType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.querySelectorAll('.checkbox-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.closest('.checkbox-item').classList.add('active');
                });
            });

            // Handle form submission
            const promptForm = document.getElementById('promptForm');
            if (promptForm) {
                promptForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const apiKey = sessionData.useHardcoded ? 
                        HARDCODED_KEYS[sessionData.apiProvider] : 
                        sessionData.apiKey;
                    
                    const apiProvider = sessionData.apiProvider;
                    
                    if (!apiKey || apiKey.includes('YOUR_') || apiKey.includes('_HERE')) {
                        alert('Please enter a valid API key or update the hardcoded keys in the code!');
                        return;
                    }

                    const formData = getFormData();
                    if (!validateForm(formData)) {
                        return;
                    }

                    showLoading();
                    
                    try {
                        const result = await generateContent(formData, apiKey, apiProvider);
                        displayResults(result);
                    } catch (error) {
                        console.error('Full Error Details:', error);
                        let errorMessage = 'Error generating content. ';
                        
                        if (error.message.includes('API request failed')) {
                            errorMessage += 'API request failed. Please check:\n';
                            errorMessage += '‚Ä¢ Your API key is correct\n';
                            errorMessage += '‚Ä¢ You have sufficient API credits\n';
                            errorMessage += '‚Ä¢ Your internet connection is stable\n\n';
                            errorMessage += `Details: ${error.message}`;
                        } else if (error.message.includes('CORS')) {
                            errorMessage += 'CORS error. Try using a different API provider or check your network settings.';
                        } else {
                            errorMessage += error.message;
                        }
                        
                        alert(errorMessage);
                        hideLoading();
                    }
                });
            }

            // Handle product form submission
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const formData = {
                        name: document.getElementById('productName').value.trim(),
                        category: document.getElementById('productCategory').value,
                        description: document.getElementById('productDescription').value.trim(),
                        motto: document.getElementById('productMotto').value.trim(),
                        features: document.getElementById('productFeatures').value.trim(),
                        market: document.getElementById('productMarket').value.trim()
                    };

                    if (!formData.name || !formData.description) {
                        alert('Please fill in at least the product name and description!');
                        return;
                    }

                    const editingId = this.dataset.editingId;
                    
                    if (editingId) {
                        const index = savedProducts.findIndex(p => p.id === editingId);
                        if (index !== -1) {
                            savedProducts[index] = { ...formData, id: editingId };
                            if (selectedProduct?.id === editingId) {
                                selectedProduct = savedProducts[index];
                                updateSelectedProductDisplay();
                            }
                        }
                        delete this.dataset.editingId;
                    } else {
                        const newProduct = {
                            ...formData,
                            id: 'product_' + Date.now()
                        };
                        savedProducts.push(newProduct);
                        selectedProduct = newProduct;
                        updateSelectedProductDisplay();
                    }

                    this.reset();
                    switchTab('saved');
                    renderSavedProducts();
                });
            }
        });
    </script>
</body>
</html>